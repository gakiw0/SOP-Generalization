# UI簡素化 修正計画書（想定ユーザー: メカ知識ゼロのスポーツコーチ）

## 1. 目的とゴール
### 背景
現状のUI（`ui/src/App.tsx`）は「Rule Set Builder」として、エンジン向けの `rule-set(JSON)` をフル編集できますが、初見のコーチにとっては情報量・専門用語・選択肢が多く、初期画面のハードルが高いです。

### ゴール（UX）
- 初期画面を「最小の選択肢」で開始できる（迷わせない）
- 主要タスクを“質問に答えるだけ”で完了できる（段階的開示）
- 誤設定をしにくい（テンプレート/安全なデフォルト/ガードレール）
- 既存のカスタマイズ性（ルールセットの柔軟性）は維持する（上級者/開発者向け導線を残す）

### 非ゴール（今回やらない）
- エンジン側の仕様変更（`schema` や plugin の大規模改修）
- コーチ向けの分析可視化（スコアリング/タイムラインのリッチUI）
- ユーザー/権限/DB/サーバ実装（必要なら別計画に分離）

## 2. 現状把握（UIの役割と課題）
### 現状UIの役割
- `RuleSet` の全要素（`phases/rules/conditions/score/feedback` 等）を編集し、`Validate` と `Export` ができる
- `metric` は自由入力で、エンジンに存在するかはユーザーが知っている前提

### コーチ視点の課題（現状）
- 専門用語（phase/signal/metric/condition/composite 等）前提で心理的負担が大きい
- 何から始めればよいか分からない（最初から全部のセクションが出る）
- 正しい入力の“道筋”がない（テンプレート/ウィザードがない）
- エンジン側制約（OpenPose25前提、`inputs` の一部が無効等）がUIから直感的でない

## 3. デザイン方針（コーチ向け）
### 原則
1) **段階的開示**: 初期は「やること」だけ。詳細は必要になった時だけ見せる  
2) **テンプレート駆動**: 0→1 をテンプレで作り、コーチは“調整”に集中  
3) **用語変換**: 内部の `phase/metric/signal` を、UI表示では「動作の区間/チェック項目/判定範囲」等に置き換える  
4) **安全なデフォルト**: 迷ったらOKな既定値（後から上書き可能）  
5) **失敗しにくい入力**: 自由入力を減らし、選択式（ドロップダウン/検索/スライダー）を増やす  

## 4. 目指す画面構成（“簡単モード” + “詳細モード”）
### 4.1 初期画面（Landing）
最初に見せるのは2択のみ。
- **かんたんに作る（おすすめ）**: ウィザード/テンプレート中心
- **詳細に編集する（上級者）**: 現在のフルエディタ（既存機能）に遷移

補足:
- 「詳細に編集する」は目立たせすぎず、常に戻れる導線として配置

### 4.2 かんたんモード（ウィザード）
最小ステップで「使える rule-set を出力」する。

ステップ案:
1. **競技/テンプレ選択**  
   - `sport` を選ぶ（例: baseball）  
   - 既成テンプレ（例: “スイング基礎チェック”）を選ぶ  
2. **タイトルだけ入力**  
   - `metadata.title` のみ必須。その他は自動設定  
3. **チェック項目のON/OFF + 強さ（しきい値調整）**  
   - 例: 「体幹のブレ」「股関節回旋」「頭の移動」など、人間向け名称でリスト化  
   - ON/OFF（有効化）  
   - しきい値は「ゆるい/ふつう/きびしい」などのプリセット + 追加調整（スライダー）  
4. **出力**  
   - `Validate` を自動実行して結果を分かりやすく表示  
   - `Export`（JSONダウンロード）

### 4.3 詳細モード（フル編集）
現状の `Draft/Inputs/Globals/Phases/Rules/JSON Preview` を維持しつつ、以下を改善する。
- セクション折りたたみ（デフォルトは閉）
- “内部用語”の補助テキスト（短く）
- `metric` は自由入力に加えて「候補から選択（検索）」を提供

## 5. かんたんモードを支えるデータ設計
### 5.1 テンプレート（RuleSetテンプレ）を中核にする
基本方針: コーチが0から `phases/rules/signal/conditions` を組む必要をなくし、テンプレの“調整”にする。

- テンプレは `RuleSet` そのもの（または差分）で保持
- コーチ向けには「チェック項目（= rule の束）」として抽象化して提示
- コーチの操作は、主に以下の変更に限定する:
  - `rule.enabled` 相当（現状スキーマに無い場合は、UI側でON/OFF→該当ruleを出力から除外）
  - `conditions[].value`（閾値/範囲）
  - `rule.severity` / `feedback.severity`（重要度）
  - `globals.confidence_threshold`（信頼度の最低ライン）
  - `globals.feature_pipeline`（必要なら、テンプレに紐づく推奨ON）

### 5.2 metricの“人間向け辞書”を導入
現状の `metric` は自由入力のため、コーチには難しい。
次を実装して解決する:
- `Engine/configs/metrics/base_metric_catalog_v1.json` を読み、`metric_id -> 表示名/説明/単位/推奨範囲` をUIで参照
- UIでは「表示名」で選択し、JSONには `metric_id` を保存

## 6. 実装方針（段階的リファクタ）
### マイルストーン0: UIの土台分割（安全に進める）
目的: 既存機能を壊さず、構造を分けて変更できるようにする。
- `App.tsx` をコンポーネント分割（例: `SimpleMode`, `AdvancedMode`, `RuleSetEditor`）
- `RuleSet` 型/バリデーション/ユーティリティを別ファイル化
- 既存の `AdvancedMode` は挙動を維持（見た目変更は最小）

### マイルストーン1: 初期画面の導入（Landing + モード切替）
目的: 初期画面をシンプルにし、コーチが迷わず開始できるようにする。
- 初期ルートは Landing を表示
- 「かんたん」「詳細」切替（状態はURLクエリ or localStorageで保持）

### マイルストーン2: かんたんモード（テンプレ選択→最低限の出力）
目的: コーチが最小操作で Export まで到達できる。
- テンプレの静的同梱（`ui/src/templates/*.json` など）
- `metadata.title` だけ入力できるフォーム
- `Validate` の自動実行と、コーチ向けエラー表示（専門用語を避ける）

### マイルストーン3: チェック項目のON/OFF + 閾値調整
目的: カスタマイズ性を“コーチ向けに再表現”する。
- テンプレ内の rule を「チェック項目」として一覧化
- 代表的な調整点（主に `conditions[].value`）をUI上のスライダー/プリセットにマッピング
- プリセット（ゆるい/ふつう/きびしい）はテンプレ側で係数/値を定義できるようにする

### マイルストーン4: 詳細モード改善（品質向上）
目的: 上級者の編集体験を落とさない。
- セクション折りたたみ
- `metric` の候補検索（カタログから）
- JSON Preview のコピー/インポート（必要なら）

## 7. 受け入れ基準（Definition of Done）
### かんたんモード
- 初期画面は「かんたん/詳細」の2択が主で、専門用語が露出しない
- かんたんモードでテンプレを選び、タイトルを入れて Export できる
- チェック項目のON/OFFと、少なくとも1つの閾値を調整して Export できる

### 詳細モード
- 既存のフル編集機能が維持される（New/Validate/Export/JSON Preview）
- metric候補表示などの改善が入っても、自由入力は可能（逃げ道を残す）

## 8. リスクと対策
- リスク: “かんたんモード”が増えることで、テンプレ整備コストが発生  
  - 対策: まずは1競技1テンプレで開始し、運用で拡張
- リスク: エンジン仕様（利用可能なmetric/event）が不明瞭だとUIの辞書が陳腐化  
  - 対策: `base_metric_catalog_v1.json` を単一情報源にし、UIはそれを参照
- リスク: スキーマに「ruleの有効/無効」が無い  
  - 対策: “無効化=出力から除外”で表現し、必要なら後続でスキーマ拡張を検討

## 9. 変更対象（想定ファイル）
- `ui/src/App.tsx`（分割の起点）
- `ui/src/*`（新規: Simple/Advanced コンポーネント、テンプレ、カタログ読み込み）
- `Engine/configs/metrics/base_metric_catalog_v1.json`（参照のみ。仕様変更が必要なら別途計画）

